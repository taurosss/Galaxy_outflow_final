import matplotlib.pyplot as plt
from numpy import exp, linspace, pi, random, sign, sin, array
from lmfit import Parameters, minimize
from lmfit.printfuncs import report_fit

p_true = Parameters()
p_true.add('amp_g1', value=50.0)
p_true.add('cen_g1', value=0.0)
p_true.add('wid_g1', value=200)



def residual(pars, x, data=None):
    argu = (x - pars['cen_g1'])**2 / (2*(pars['wid_g1'])**2)
    model = pars['amp_g1'] * exp(-argu)
    if data is None:
        return model
    return model - data

x = array([ 1227.07001083,  1216.75996658,  1206.45062855,  1196.14199666,
        1185.83407086,  1175.52685106,  1165.22033719,  1154.91452918,
        1144.60942696,  1134.30503045,  1124.00133959,  1113.69835429,
        1103.3960745 ,  1093.09450013,  1082.79363111,  1072.49346737,
        1062.19400883,  1051.89525544,  1041.5972071 ,  1031.29986376,
        1021.00322533,  1010.70729175,  1000.41206294,   990.11753883,
         979.82371935,   969.53060443,   959.23819399,   948.94648796,
         938.65548628,   928.36518885,   918.07559563,   907.78670652,
         897.49852147,   887.21104039,   876.92426322,   866.63818988,
         856.3528203 ,   846.06815441,   835.78419214,   825.50093341,
         815.21837815,   804.9365263 ,   794.65537777,   784.3749325 ,
         774.09519041,   763.81615143,   753.53781549,   743.26018252,
         732.98325244,   722.70702519,   712.43150068,   702.15667886,
         691.88255964,   681.60914296,   671.33642873,   661.0644169 ,
         650.79310739,   640.52250012,   630.25259503,   619.98339204,
         609.71489108,   599.44709208,   589.17999497,   578.91359967,
         568.64790611,   558.38291422,   548.11862393,   537.85503517,
         527.59214786,   517.32996194,   507.06847732,   496.80769395,
         486.54761174,   476.28823063,   466.02955054,   455.7715714 ,
         445.51429315,   435.2577157 ,   425.00183898,   414.74666293,
         404.49218748,   394.23841254,   383.98533805,   373.73296394,
         363.48129014,   353.23031656,   342.98004315,   332.73046984,
         322.48159653,   312.23342318,   301.9859497 ,   291.73917602,
         281.49310208,   271.2477278 ,   261.0030531 ,   250.75907792,
         240.51580218,   230.27322582,   220.03134876,   209.79017093,
         199.54969226,   189.30991268,   179.07083211,   168.83245049,
         158.59476773,   148.35778378,   138.12149856,   127.88591199,
         117.65102401,   107.41683455,    97.18334353,    86.95055088,
          76.71845653,    66.4870604 ,    56.25636244,    46.02636256,
          35.7970607 ,    25.56845677,    15.34055072,     5.11334247,
          -5.11316805,   -15.33898091,   -25.56409619,   -35.78851396,
         -46.01223428,   -56.23525723,   -66.45758288,   -76.67921131,
         -86.90014257,   -97.12037675,  -107.33991391,  -117.55875413,
        -127.77689748,  -137.99434402,  -148.21109384,  -158.427147  ,
        -168.64250357,  -178.85716362,  -189.07112723,  -199.28439447,
        -209.4969654 ,  -219.7088401 ,  -229.92001864,  -240.1305011 ,
        -250.34028753,  -260.54937802,  -270.75777264,  -280.96547145,
        -291.17247452,  -301.37878194,  -311.58439376,  -321.78931007,
        -331.99353093,  -342.1970564 ,  -352.39988658,  -362.60202151,
        -372.80346129,  -383.00420597,  -393.20425563,  -403.40361033,
        -413.60227016,  -423.80023518,  -433.99750546,  -444.19408107,
        -454.38996208,  -464.58514857,  -474.77964061,  -484.97343826,
        -495.16654161,  -505.35895071,  -515.55066563,  -525.74168646,
        -535.93201327,  -546.12164611,  -556.31058507,  -566.49883021,
        -576.6863816 ,  -586.87323932,  -597.05940344,  -607.24487403,
        -617.42965115,  -627.61373488,  -637.7971253 ,  -647.97982246,
        -658.16182644,  -668.34313732,  -678.52375516,  -688.70368004,
        -698.88291201,  -709.06145117,  -719.23929757,  -729.41645128,
        -739.59291239,  -749.76868095,  -759.94375704,  -770.11814073,
        -780.29183209,  -790.46483119,  -800.63713811,  -810.8087529 ,
        -820.97967565,  -831.14990642,  -841.31944529,  -851.48829232,
        -861.65644758,  -871.82391115,  -881.9906831 ,  -892.1567635 ,
        -902.32215241,  -912.48684991,  -922.65085607,  -932.81417095,
        -942.97679464,  -953.1387272 ,  -963.2999687 ,  -973.46051921,
        -983.6203788 ,  -993.77954754, -1003.93802551, -1014.09581276,
       -1024.25290939, -1034.40931544, -1044.565031  , -1054.72005614,
       -1064.87439092, -1075.02803541, -1085.1809897 , -1095.33325383,
       -1105.4848279 , -1115.63571196, -1125.78590609, -1135.93541036,
       -1146.08422483, -1156.23234958, -1166.37978469, -1176.52653021,
       -1186.67258622, -1196.81795279, -1206.96262999, -1217.10661789])


data = array([-2.02235985e+00, -4.91877735e-01,  5.55702150e-02, -1.36172533e-01,
       -2.06994712e-01,  9.04598534e-02, -1.78134903e-01, -3.49807024e-01,
        3.83172035e-02, -6.50026947e-02,  1.18116289e-03, -2.22209692e-01,
       -2.31368989e-01,  2.03847587e-01,  4.51357305e-01,  2.15462774e-01,
        4.19623330e-02,  1.76399946e-03, -1.17091164e-01, -3.46796989e-01,
        1.58708453e-01,  2.47255668e-01, -2.77256042e-01,  1.87190667e-01,
        5.92830032e-02, -2.55714625e-01,  1.94008723e-01, -1.21650368e-01,
       -3.63914669e-01, -1.40741989e-02,  9.66625512e-02,  2.47899398e-01,
       -1.83227062e-01, -2.59154618e-01, -1.68983400e-01, -1.27620384e-01,
        8.54334384e-02,  7.94622600e-02, -1.33527786e-01, -1.57845736e-01,
       -3.65694940e-01, -1.57687113e-01,  1.87973842e-01,  1.47199661e-01,
        3.58705848e-01,  2.99396276e-01,  2.05822527e-01,  5.38677759e-02,
        1.99060723e-01,  1.35058165e-01,  2.42619112e-01, -2.10218832e-01,
       -1.52856410e-01, -1.20514035e-02,  2.71888673e-01, -2.61041254e-01,
       -2.89091095e-02,  2.36568049e-01,  1.23959087e-01,  3.40343535e-01,
        7.13922381e-02,  4.39520299e-01,  2.36668020e-01, -7.29740858e-02,
        6.71556294e-02, -3.76745850e-01,  2.78205961e-01, -1.30911693e-02,
       -2.98824459e-02, -1.31190151e-01,  1.98925048e-01,  1.22598849e-01,
        1.78246260e-01, -2.98825532e-01,  2.67153800e-01, -1.30003542e-02,
        5.96183017e-02,  3.48248601e-01, -2.01071277e-01,  8.62294063e-02,
       -2.11835876e-02,  1.66852385e-01, -1.57115042e-01,  1.35778591e-01,
        8.53403926e-01,  3.12743950e+00,  7.70736885e+00,  1.35773678e+01,
        1.24097996e+01,  9.24734497e+00,  7.82735300e+00,  4.84414577e+00,
        6.08961868e+00,  1.06162233e+01,  1.77263088e+01,  2.19074421e+01,
        2.52125416e+01,  2.98498554e+01,  3.54152145e+01,  3.70702438e+01,
        3.58891678e+01,  3.46621895e+01,  3.72959251e+01,  4.20461121e+01,
        4.53496094e+01,  4.55074921e+01,  4.85455780e+01,  4.81678848e+01,
        4.82742805e+01,  4.86467438e+01,  4.90167198e+01,  4.85676460e+01,
        4.97732124e+01,  4.99163322e+01,  4.63659058e+01,  4.57695198e+01,
        4.61537170e+01,  4.34395905e+01,  4.45453339e+01,  4.79947281e+01,
        4.99738007e+01,  4.66689224e+01,  4.08501740e+01,  4.04259605e+01,
        3.57269592e+01,  2.86263695e+01,  2.70802193e+01,  2.72560158e+01,
        2.68455849e+01,  2.43307076e+01,  2.06537209e+01,  1.69574814e+01,
        1.52710409e+01,  1.46269875e+01,  1.00887547e+01,  6.14789009e+00,
        5.69386768e+00,  7.79359627e+00,  8.39723778e+00,  7.14561176e+00,
        6.83406639e+00,  4.92586613e+00,  1.45246828e+00,  1.01228416e-01,
       -2.18365639e-02,  6.66372031e-02,  3.32535356e-01,  1.05793267e-01,
       -1.67910457e-02,  1.33614480e-01,  1.73089206e-02,  4.82121170e-01,
       -1.71592891e-01, -3.44717503e-02,  1.93094201e-02,  2.84949448e-02,
       -1.94524541e-01,  1.13687485e-01, -6.02679700e-02,  6.02673963e-02,
       -3.74740720e-01, -9.02045295e-02, -1.37501478e-01,  1.70965254e-01,
        7.14533702e-02,  3.06593329e-02, -3.89463514e-01,  8.31973180e-02,
        1.79716736e-01,  2.50477523e-01, -1.24508739e-02,  4.59820032e-02,
        3.09761643e-01, -7.74240121e-02,  1.23345934e-01,  6.81126267e-02,
        3.18491131e-01,  1.16281174e-02,  2.37655565e-02,  3.66601288e-01,
       -1.33561850e-01,  7.22017735e-02, -1.07594430e-01,  2.31070071e-02,
        3.83545280e-01,  3.09592545e-01,  1.12102479e-01, -9.27462652e-02,
       -2.21840739e-02, -1.71767384e-01, -3.05193007e-01, -2.17800200e-01,
       -4.11635458e-01, -1.68327421e-01, -1.64102122e-01,  7.69972354e-02,
       -3.59825820e-01,  1.62506402e-01,  9.13265347e-02, -6.61869049e-02,
       -1.11303240e-01, -2.45802104e-03,  2.82732621e-02, -1.81241930e-02,
       -2.35553026e-01,  1.64498419e-01,  3.16299200e-02,  1.29224956e-01,
       -2.86401123e-01,  6.00121260e-01,  4.06489044e-01, -4.04313713e-01,
       -2.53160298e-03, -1.61701724e-01, -2.48826832e-01, -5.28879166e-02,
       -3.01360905e-01,  5.48365749e-02, -2.13499531e-01, -2.00972244e-01,
        8.98452774e-02, -3.69319469e-02, -3.12845379e-01,  5.27683869e-02,
        2.74388492e-02, -7.52054602e-02, -5.90889007e-02,  4.52716827e-01,
        1.72336578e-01, -4.30795401e-02, -2.69248873e-01, -7.02394396e-02,
        3.36443558e-02,  1.13698319e-01,  1.54658347e-01, -6.16709590e-02,
       -4.85732913e-01,  2.07352355e-01,  1.86785102e-01,  5.38357496e-02])

fit_params = Parameters()
fit_params.add('amp_g1', value=50, max=52, min=48)
fit_params.add('cen_g1', value=0, max=100)
fit_params.add('wid_g1', value=100)

out = minimize(residual, fit_params, args=(x,), kws={'data': data})
fit = residual(out.params, x)

report_fit(out, modelpars=p_true)

plt.plot(x, data, 'o', label='data')
plt.plot(x, fit, label='best fit')
plt.legend()





